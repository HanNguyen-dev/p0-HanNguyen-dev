using System;
using System.IO;
using System.Collections;
using System.Collections.Generic;
using PizzaBox.Domain.Models;
using Newtonsoft.Json;


namespace PizzaBox.Storing.Repositories {

  public class UserRepository
  {
    private const string FILE = "PizzaBox.Storing/Repositories/users.json";

    public static Hashtable readData()
    {
      Hashtable userAccount = new Hashtable();

      StreamReader reader = new StreamReader(FILE);
      List<Account> accounts = JsonConvert.DeserializeObject<List<Account>>(reader.ReadToEnd());

      foreach(Account account in accounts)
      {
        userAccount.Add(account.username, account);
      }

      return userAccount;
    }

    public static void writeData(Hashtable newUserPass)
    {
      ICollection accounts = newUserPass.Values;
      List<Account> updatedList = new List<Account>();

      foreach(Account account in accounts)
      {
        updatedList.Add(account);
      }
      string jsonString = JsonConvert.SerializeObject(updatedList);

      StreamWriter writer = new StreamWriter(FILE);
      writer.Write(jsonString);
      writer.Close();
    }

  }
}